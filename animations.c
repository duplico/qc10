#include <stdint.h>
#include <avr/io.h>
#include <avr/interrupt.h>
#include <util/delay.h>

#include "tlc5940.h"
#include "animations.h"

QCSys heartbeats[][4] = {
  {{32, 0, 0, 0, 3000}, // Red, .2/3sec
   {0, 0, 0, 0, 200},
   {32, 0, 0, 0, 200},
   {0, 0, 0, 0, 200}},
   
  {{32, 14, 0, 0, 1500}, // Orange, .2/1.5sec
   {0, 0, 0, 0, 200},
   {32, 14, 0, 0, 200},
   {0, 0, 0, 0, 200}},
   
  {{32, 24, 0, 0, 1000}, // Yellow, .2/1.0sec
   {0, 0, 0, 0, 200},
   {32, 24, 0, 0, 200},
   {0, 0, 0, 0, 200}},
   
  {{0, 32, 0, 0, 800}, // Green, .15/0.8sec
   {0, 0, 0, 0, 150},
   {0, 32, 0, 0, 150},
   {0, 0, 0, 0, 150}},
   
  {{0, 0, 32, 0, 500}, // Blue, .15/0.5sec
   {0, 0, 0, 0, 150},
   {0, 0, 32, 0, 150},
   {0, 0, 0, 0, 150}},
   
  {{20, 0, 24, 0, 400}, // Violet, .125/0.4sec
   {0, 0, 0, 0, 125},
   {20, 0, 24, 0, 125},
   {0, 0, 0, 0, 125}},
   
  {{32, 0, 18, 0, 250}, // Pink, .1/0.25sec
   {0, 0, 0, 0, 100},
   {32, 0, 18, 0, 100},
   {0, 0, 0, 0, 100}},
};


#define QCR_DELAY 100
QCRing bling1[] = {
  {0, 0, 0, 0, 0, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {128, 0, 0, 0, 0, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 0,
   128, 0, 0, 0, 0, 128,
   QCR_DELAY},
  {0, 128, 0, 0, 0, 128,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 0,
   0, 128, 0, 0, 128, 0,
   QCR_DELAY},
  {0, 0, 128, 0, 128, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 0,
   0, 0, 128, 128, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 128, 0, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 0,
   0, 0, 128, 128, 0, 0,
   QCR_DELAY},
  {0, 0, 128, 0, 128, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 0,
   0, 128, 0, 0, 128, 0,
   QCR_DELAY},
  {0, 128, 0, 0, 0, 128,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 0,
   128, 0, 0, 0, 0, 128,
   QCR_DELAY},
  {128, 0, 0, 0, 0, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY}
};
#define BLING1LEN 15

// EFFECT: Bouncing color pairs.
#define QCR_DELAY 100
QCRing bling2[] =  {
  {0, 0, 0, 0, 0, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 128, 0, 0, 0, 0,
   0, 128, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 128, 0,
   0, 0, 0, 0, 128, 0,
   QCR_DELAY},
  {0, 0, 0, 128, 0, 0,
   0, 0, 0, 128, 0, 0,
   QCR_DELAY},
  {128, 0, 0, 0, 0, 0,
   128, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 128,
   0, 0, 0, 0, 0, 128,
   QCR_DELAY},
  {0, 0, 128, 0, 0, 0,
   0, 0, 128, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 128, 0,
   0, 0, 0, 0, 128, 0,
   QCR_DELAY},
  {0, 128, 0, 0, 0, 0,
   0, 128, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 128, 0, 0,
   0, 0, 0, 128, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 128,
   0, 0, 0, 0, 0, 128,
   QCR_DELAY},
  {0, 0, 128, 0, 0, 0,
   0, 0, 128, 0, 0, 0,
   QCR_DELAY},
  {128, 0, 0, 0, 0, 0,
   128, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY}};
#define BLING2LEN 15

// EFFECT: Bouncing single LED
#define QCR_DELAY 100
QCRing bling3[] = {
  {0, 0, 0, 0, 0, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 128, 0, 0, 0, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 0,
   0, 0, 0, 128, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 0,
   0, 0, 128, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 128,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 128, 0, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 0,
   0, 0, 0, 0, 128, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 0,
   0, 128, 0, 0, 0, 0,
   QCR_DELAY},
  {128, 0, 0, 0, 0, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 128, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 0,
   0, 0, 0, 0, 0, 128,
   QCR_DELAY},
  {0, 0, 128, 0, 0, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 0,
   128, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY}};
#define BLING3LEN 14

// EFFECT: Backwards rotation of color pairs, twice
QCRing bling4[] = {
  {0, 0, 0, 0, 0, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {128, 0, 0, 0, 0, 0,
   128, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 128,
   0, 0, 0, 0, 0, 128,
   QCR_DELAY},
  {0, 0, 0, 0, 128, 0,
   0, 0, 0, 0, 128, 0,
   QCR_DELAY},
  {0, 0, 0, 128, 0, 0,
   0, 0, 0, 128, 0, 0,
   QCR_DELAY},
  {0, 0, 128, 0, 0, 0,
   0, 0, 128, 0, 0, 0,
   QCR_DELAY},
  {0, 128, 0, 0, 0, 0,
   0, 128, 0, 0, 0, 0,
   QCR_DELAY},
  {128, 0, 0, 0, 0, 0,
   128, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 128,
   0, 0, 0, 0, 0, 128,
   QCR_DELAY},
  {0, 0, 0, 0, 128, 0,
   0, 0, 0, 0, 128, 0,
   QCR_DELAY},
  {0, 0, 0, 128, 0, 0,
   0, 0, 0, 128, 0, 0,
   QCR_DELAY},
  {0, 0, 128, 0, 0, 0,
   0, 0, 128, 0, 0, 0,
   QCR_DELAY},
  {0, 128, 0, 0, 0, 0,
   0, 128, 0, 0, 0, 0,
   QCR_DELAY},
  {128, 0, 0, 0, 0, 0,
   128, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY}};
#define BLING4LEN 15

// EFFECT: Alternating opposite lights while spinning clockwise.
#define QCR_DELAY 100
QCRing bling5[] = {
  {0, 0, 0, 0, 0, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {128, 0, 0, 0, 0, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 128, 0, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 0,
   128, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 0,
   0, 0, 0, 128, 0, 0,
   QCR_DELAY},
  {0, 128, 0, 0, 0, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 128, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 0,
   0, 128, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 0,
   0, 0, 0, 0, 128, 0,
   QCR_DELAY},
  {0, 0, 128, 0, 0, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 128,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 0,
   0, 0, 128, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 0,
   0, 0, 0, 0, 0, 128,
   QCR_DELAY},
  {128, 0, 0, 0, 0, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {128, 0, 0, 0, 0, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY},
  {0, 0, 0, 0, 0, 0,
   0, 0, 0, 0, 0, 0,
   QCR_DELAY}};
   
#define BLING5LEN 16

QCRing *ring_animations[] = {&bling1, &bling2, &bling3, &bling4, &bling5};
uint8_t ring_anim_lengths[] = {BLING1LEN, BLING2LEN, BLING3LEN, BLING4LEN, BLING5LEN};
